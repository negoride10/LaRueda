<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="user-summary">
      <div class="user-name">
        Bienvenido, {{ userData?.user?.name || "Usuario" }}
      </div>
      <div class="candidate-badge">
        Código del candidato:
        <strong>{{
          userData?.user?.candidate_code || userData?.candidate_code || "—"
        }}</strong>
      </div>
    </div>

    <button class="logout-btn" (click)="logout()">Cerrar Sesión</button>
  </div>

  <!-- Sección de Contactos -->
  <div class="contacts-section">
    <div class="section-header">
      <h2>Gestión de Contactos</h2>
      <button class="btn-create" (click)="openCreateModal()">
        <span>+</span> Crear Contacto
      </button>
    </div>

    <!-- Búsqueda Avanzada -->
    <div class="search-container">
      <h3>Búsqueda Avanzada</h3>
      <div class="search-filters">
        <div class="filter-group">
          <label for="searchNombre">Nombre:</label>
          <input
            id="searchNombre"
            type="text"
            [(ngModel)]="searchNombre"
            (ngModelChange)="applyFilters()"
            placeholder="Buscar por nombre..."
          />
        </div>
        <div class="filter-group">
          <label for="searchCelular">Celular:</label>
          <input
            id="searchCelular"
            type="text"
            [(ngModel)]="searchCelular"
            (ngModelChange)="applyFilters()"
            placeholder="Buscar por celular..."
          />
        </div>
        <div class="filter-group">
          <label for="searchPlaca">Placa:</label>
          <input
            id="searchPlaca"
            type="text"
            [(ngModel)]="searchPlaca"
            (ngModelChange)="applyFilters()"
            placeholder="Buscar por placa..."
          />
        </div>
        <div class="filter-group">
          <button class="btn-clear" (click)="clearFilters()">Limpiar Filtros</button>
        </div>
      </div>
    </div>

    <!-- Tabla de Contactos -->
    <div class="table-container">
      <div *ngIf="isLoadingContacts" class="loading-message">
        Cargando contactos...
      </div>

      <table *ngIf="!isLoadingContacts" class="contacts-table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Celular</th>
            <th>Placa</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="filteredContacts.length === 0">
            <td colspan="3" class="no-data">
              No hay contactos disponibles. Haz clic en "Crear Contacto" para agregar uno.
            </td>
          </tr>
          <tr *ngFor="let contact of filteredContacts">
            <td>{{ contact.nombre }}</td>
            <td>{{ contact.celular }}</td>
            <td>{{ contact.placa || '—' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button
        class="btn-page"
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)"
      >
        Anterior
      </button>
      <span class="page-info">
        Página {{ currentPage }} de {{ totalPages }} (Total: {{ totalContacts }} contactos)
      </span>
      <button
        class="btn-page"
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)"
      >
        Siguiente
      </button>
    </div>
  </div>

  <!-- Modal de Creación -->
  <div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Crear Nuevo Contacto</h2>
        <button class="btn-close" (click)="closeCreateModal()">&times;</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="nombre">Nombre: <span class="required">*</span></label>
          <input
            id="nombre"
            type="text"
            [(ngModel)]="newContact.nombre"
            placeholder="Ingrese el nombre"
            [disabled]="isCreating"
          />
        </div>

        <div class="form-group">
          <label for="celular">Celular: <span class="required">*</span></label>
          <input
            id="celular"
            type="text"
            [(ngModel)]="newContact.celular"
            placeholder="Ingrese el celular"
            [disabled]="isCreating"
          />
        </div>

        <div class="form-group">
          <label for="placa">Placa:</label>
          <input
            id="placa"
            type="text"
            [(ngModel)]="newContact.placa"
            placeholder="Ingrese la placa (opcional)"
            [disabled]="isCreating"
          />
        </div>

        <div class="message success-message" *ngIf="createMessage">
          {{ createMessage }}
        </div>

        <div class="message error-message" *ngIf="createError">
          {{ createError }}
        </div>
      </div>

      <div class="modal-footer">
        <button
          class="btn-cancel"
          (click)="closeCreateModal()"
          [disabled]="isCreating"
        >
          Cancelar
        </button>
        <button
          class="btn-save"
          (click)="createContact()"
          [disabled]="isCreating"
        >
          {{ isCreating ? 'Guardando...' : 'Guardar' }}
        </button>
      </div>
    </div>
  </div>

  <ng-template #noUser>
    <div class="welcome-message">
      <p>No se encontró información del usuario. Por favor inicia sesión.</p>
    </div>
  </ng-template>
</div>
